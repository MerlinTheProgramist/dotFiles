#
# ~/.bashrc
#

if [ "$XDG_SESSION_TYPE" == "wayland" ]; then
  export MOZ_ENABLE_WAYLAND=1
  export QT_QPA_PLATFORM=wayland
  export GDK_BACKEND=wayland,x11
fi

# For matlab to show the plots correctly with java
export _JAVA_AWT_WM_NONREPARENTING=1

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

export HISTCONTROL=ignoreboth:erasedups

# export ASAN_SYMBOLIZER_PATH=

# Make helix the default editor
export EDITOR='helix'
export VISUAL='helix'

# esp enviroment
alias get_idf='source $HOME/esp/esp-idf/export.sh'
# source $HOME/esp/esp-idf/export.sh


#PS1='[\u@\h \W]\$ '

if [ -d "$HOME/.bin" ] ;
  then PATH="$HOME/.bin:$PATH"
fi

if [ -d "$HOME/.local/bin" ] ;
  then PATH="$HOME/.local/bin:$PATH"
fi

export PATH="/home/$USER/.local/share/gem/ruby/3.0.0/bin:$PATH"
export PATH="~/rofi-translate:$PATH"
export PATH="~/.cargo/bin/:$PATH"
export PATH="~/.platformio/penv/bin:$PATH"

diff-bin(){
  colordiff <(xxd $1) <(xxd $2)
}

all-the-colors(){
  for x in {1..7}; do
    printf "\033[3${x}m3${x}: (^-^)\033[0m\n"
  done
}

#ignore upper and lowercase when TAB completion
bind "set completion-ignore-case on"

#list
alias ls='ls --color=auto'
alias la='ls -a'
alias ll='ls -lah'
alias l='ls'
alias l.="ls -A | egrep '^\.'"

#userful shorts
alias c='clear'
alias t='alacritty --hold & disown'


#fix obvious typo's
alias cd..='cd ..'
alias ..='cd ..'

# remind of typo
alias whitch="echo 'did you ment: which, learn the commands!'"
alias wchih="echo 'did you ment: which, learn the commands!'"

# more intuitive shortcuts
alias rm="rm -i"
alias tr="trash"

# helix
alias hx="helix"

## Colorize the grep command output for ease of use (good for log files)##
alias grep='grep --color=auto'
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'

#readable output
alias df='df -h'

#pacman unlock
alias unlock="sudo rm /var/lib/pacman/db.lck"
alias rmpacmanlock="sudo rm /var/lib/pacman/db.lck"

#free
alias free="free -mt"

#continue download
alias wget="wget -c"

#userlist
alias userlist="cut -d: -f1 /etc/passwd"

#merge new settings
alias merge="xrdb -merge ~/.Xresources"

# Aliases for software managment
# pacman or pm
alias pacman='sudo pacman --color auto'
alias update='sudo pacman -Syyu'

# paru as aur helper - updates everything
alias pksyua="paru -Syu --noconfirm"
alias upall="paru -Syu --noconfirm"

#ps
alias psa="ps auxf"
alias psgrep="ps aux | grep -v grep | grep -i -e VSZ -e"

#grub update
alias update-grub="sudo grub-mkconfig -o /boot/grub/grub.cfg"

#add new fonts
alias update-fc='sudo fc-cache -fv'

#copy/paste all content of /etc/skel over to home folder - backup of config created - beware
alias skel='[ -d ~/.config ] || mkdir ~/.config && cp -Rf ~/.config ~/.config-backup-$(date +%Y.%m.%d-%H.%M.%S) && cp -rf /etc/skel/* ~'
#backup contents of /etc/skel to hidden backup folder in home/user
alias bupskel='cp -Rf /etc/skel ~/.skel-backup-$(date +%Y.%m.%d-%H.%M.%S)'

#copy bashrc-latest over on bashrc - cb= copy bashrc
alias cb='sudo cp /etc/skel/.bashrc ~/.bashrc && source ~/.bashrc'
#copy /etc/skel/.zshrc over on ~/.zshrc - cb= copy zshrc
#alias cz='sudo cp /etc/skel/.zshrc ~/.zshrc && exec zsh'

#switch between bash and zsh
alias tobash="sudo chsh $USER -s /bin/bash && echo 'Now log out.'"
alias tozsh="sudo chsh $USER -s /bin/zsh && echo 'Now log out.'"

#hardware info --short
alias hw="hwinfo --short"

#check vulnerabilities microcode
alias microcode='grep . /sys/devices/system/cpu/vulnerabilities/*'

#get fastest mirrors in your neighborhood
alias mirror="sudo reflector -f 30 -l 30 --number 10 --verbose --save /etc/pacman.d/mirrorlist"
alias mirrord="sudo reflector --latest 30 --number 10 --sort delay --save /etc/pacman.d/mirrorlist"
alias mirrors="sudo reflector --latest 30 --number 10 --sort score --save /etc/pacman.d/mirrorlist"
alias mirrora="sudo reflector --latest 30 --number 10 --sort age --save /etc/pacman.d/mirrorlist"
#our experimental - best option for the moment
alias mirrorx="sudo reflector --age 6 --latest 20  --fastest 20 --threads 5 --sort rate --protocol https --save /etc/pacman.d/mirrorlist"
alias mirrorxx="sudo reflector --age 6 --latest 20  --fastest 20 --threads 20 --sort rate --protocol https --save /etc/pacman.d/mirrorlist"
alias ram='rate-mirrors --allow-root arch | sudo tee /etc/pacman.d/mirrorlist'

#shopt
# shopt -s autocd # change to named directory
shopt -s cdspell # autocorrects cd misspellings
shopt -s cmdhist # save multi-line commands in history as single line
shopt -s dotglob
shopt -s histappend # do not overwrite history
shopt -s expand_aliases # expand aliases

#youtube download
alias yta-aac="yt-dlp --extract-audio --audio-format aac "
alias yta-best="yt-dlp --extract-audio --audio-format best "
alias yta-flac="yt-dlp --extract-audio --audio-format flac "
alias yta-mp3="yt-dlp --extract-audio --audio-format mp3 "
alias ytv-best="yt-dlp -f 'bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio' --merge-output-format mp4 "

#Recent Installed Packages
alias rip="expac --timefmt='%Y-%m-%d %T' '%l\t%n %v' | sort | tail -200 | nl"
alias riplong="expac --timefmt='%Y-%m-%d %T' '%l\t%n %v' | sort | tail -3000 | nl"

#Cleanup orphaned packages
alias cleanup='sudo pacman -Rns $(pacman -Qtdq)'

#search content with ripgrep
alias rg="rg --sort path"

#get the error messages from journalctl
alias jctl="journalctl -p 3 -xb"

#gpg
#verify signature for isos
alias gpg-check="gpg2 --keyserver-options auto-key-retrieve --verify"
alias fix-gpg-check="gpg2 --keyserver-options auto-key-retrieve --verify"
#receive the key of a developer
alias gpg-retrieve="gpg2 --keyserver-options auto-key-retrieve --receive-keys"
alias fix-gpg-retrieve="gpg2 --keyserver-options auto-key-retrieve --receive-keys"
alias fix-keyserver="[ -d ~/.gnupg ] || mkdir ~/.gnupg ; cp /etc/pacman.d/gnupg/gpg.conf ~/.gnupg/ ; echo 'done'"

#fixes
alias fix-permissions="sudo chown -R $USER:$USER ~/.config ~/.local"

#maintenance
alias big="expac -H M '%m\t%n' | sort -h | nl"

#hblock (stop tracking with hblock)
#use unhblock to stop using hblock
alias unhblock="hblock -S none -D none"

#systeminfo
alias probe="sudo -E hw-probe -all -upload"
alias sysfailed="systemctl list-units --failed"

#shutdown or reboot
alias ssn="sudo shutdown now"
alias sr="sudo reboot"

# alias stop_docker="docker stop $(docker ps -q)"

mp4-to-mp3(){
  for f in *.mp4; do 
    ffmpeg -i "$f" "${f%.mp4}.mp3"; 
    rm "$f";
  done;
}

# FZF
tagdb(){
  cat $1 | fzf +x -i
}

linksdb(){
  tagdb "~/Documents/links.txt"
}

#give the list of all installed desktops - xsessions desktops
alias xd="ls /usr/share/xsessions"

alias boox="networktablet"

compile_raylib()
{
  c++ -w -std=c++17 -I. -L. -lraylib -lglfw -lGL -lopenal -lm -pthread -ldl *.cpp -o "$1" -Wall
}

compile_cpp()
{
  c++ -Wall -std=c++17 -ldl *.cpp -o $1
}

compile_cpp_d()
{
  c++ -Wall -std=c++17 -ldl *.cpp -d -o $1 
}

compile_asm64_d()
{
  yasm -felf64 -m amd64 -g dwarf2 $1
}

mkcd()
{
  mkdir -p -- "$1" && 
     cd -P -- "$1"  
}

image-dl(){
  wget -i `wget -qO- $1 | sed -n '/<img/s/.*src="\([^"]*\)".*/\1/p'`
}

cp_sel(){
  cp -t $2 $(find . $1  | fzf -m --border=bottom --border-label='select files to copy with TAB')
}
# # ex = EXtractor for all kinds of archives
# # usage: ex <file>
ex ()
{
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2)   tar xjf $1   ;;
      *.tar.gz)    tar xzf $1   ;;
      *.bz2)       bunzip2 $1   ;;
      *.rar)       unrar x $1   ;;
      *.gz)        gunzip $1    ;;
      *.tar)       tar xf $1    ;;
      *.tbz2)      tar xjf $1   ;;
      *.tgz)       tar xzf $1   ;;
      *.zip)       unzip $1     ;;
      *.Z)         uncompress $1;;
      *.7z)        7z x $1      ;;
      *.deb)       ar x $1      ;;
      *.tar.xz)    tar xf $1    ;;
      *.tar.zst)   tar xf $1    ;;
      *)           echo "'$1' cannot be extracted via ex()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# git
alias rmgitcache="rm -r ~/.cache/git"
alias gitignore="git rm -r --cached . ; git add -A ; git commit -am 'ignore' ; git"
alias git_re-add="git update-index --again"

if [ -f "~/.gh_init.sh" ]; then
  # gh compteion
  $SHELL ~/.gh_init.sh
fi

# dictionary
alias dict_pl_en="dict -d fd-pol-eng"
alias dict_eng_pl="dict -d fd-eng-pol"

#create a file called .bashrc-personal and put all your personal aliases
[[ -f ~/.bashrc-personal ]] && . ~/.bashrc-personal

# reporting tools
neofetch # | lolcat

# shortcut keys: [Esc] [s]
bind '"\es":"sudo !#"'

parse_git_branch() {
 git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}


open_live_tex (){
  pandoc -t pdf "$1" | zathura -
}

alias matlab-term="matlab -nodesktop -nosplash"

alias nmoff="nmtui radio wifi off"
alias ip-info="ip -br -c link show up"


# get public ip
alias ippub="curl ipinfo.io/ip;"


if which pyenv 2>/dev/null ; then
  eval "$(pyenv init -)"
  eval "$(pyenv virtualenv-init -)"
fi

if which starship >/dev/null ; then
  eval "$(starship init bash)"
else
  PS1='\[\e[0m\]┌[\[\e[0m\]\u[\[\e[0m\]\[`tput setaf 2`\]\H\[\033[00m\]\n└\[\033[38;5;57m\]$(parse_git_branch)\[\033[00m\]→ '
fi

